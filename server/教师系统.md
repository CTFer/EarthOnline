<!--
 * @Author: 一根鱼骨棒 Email 775639471@qq.com
 * @Date: 2025-10-20 12:22:50
 * @LastEditTime: 2025-10-22 14:36:04
 * @LastEditors: 一根鱼骨棒
 * @Description: 本开源代码使用GPL 3.0协议
 * Software: VScode
 * Copyright 2025 迷舍
-->
# 独立教师课后练习网站开发文档

## 一、项目概述

### 1. 项目目标

开发一个移动端优先的轻量型网站，支持独立教师管理线下课程的课后练习，实现"前台展示+后台管理"一体化功能。前台面向学生和潜在用户，展示教师信息与公开资源；后台面向教师，支持班级/学生管理、作业材料分发与期限设置，满足课后练习的高效管理需求。

### 2. 核心价值

*   教师：便捷管理学生群体，精准分发音视频/文档类作业，清晰把控作业完成期限
*   学生：集中查看专属课后作业，在线完成音视频学习与文档阅读，无需下载额外工具
*   访客：了解教师资质、课程体系及公开学习资源，增强教师专业形象

## 二、功能模块设计

### （一）前台模块（用户端）

#### 1. 公共展示区（无需登录）

*   **教师简介页**
    *   核心内容：教师照片、教育背景、教学经验、擅长领域、教学理念
    *   呈现形式：图文结合，支持段落排版、资质证书图片展示
    *   交互：支持页面内锚点跳转（如从"教学理念"跳至"擅长领域"）

*   **活动页**
    *   功能：展示教师近期公开活动（如公开课、讲座、体验课等）
    *   信息项：活动标题、时间、地点（线上/线下）、简介、报名入口（可选，如手机号收集）
    *   交互：活动按时间倒序排列，过期活动自动标灰

*   **课程设置页**
    *   功能：展示教师开设的线下和线上课程体系
    *   信息项：课程名称、适合人群、课时安排、核心内容大纲、收费标准（可选）
    *   交互：支持按"难度""年龄段"筛选课程

*   **公开学习资料页**
    *   功能：提供免费公开的学习材料（如试听课片段、知识点文档）
    *   分类：按"音频""视频""文档"标签分类展示
    *   交互：点击可直接在线播放/查看（无需下载），支持材料搜索（按名称）

#### 2. 课后作业区（学生专属，需简易验证）

*   **作业入口页**
    *   验证方式：学生输入"班级ID+姓名"（由教师提前设置），提交后进入作业列表
    *   交互：验证失败提示"班级ID或姓名错误"，成功后自动跳转

*   **作业列表页**
    *   展示内容：针对该学生/班级的所有作业，按"距离截止时间"排序（近的在前）
    *   信息项：作业标题、材料类型（音频/视频/文档）、发布时间、截止时间、完成状态（未完成/已完成）
    *   交互：点击作业条目进入详情页，支持按"未完成"筛选

*   **作业详情页**
    *   功能：在线学习教师分发的材料
    *   交互：
        *   视频：支持播放/暂停、进度条拖拽、倍速调节（0.5x-2x）、全屏
        *   音频：支持播放/暂停、进度记忆（退出后下次进入继续播放）
        *   文档：支持pdf/word在线预览（优先pdf，避免格式兼容问题）、页面缩放
    *   完成标记：底部提供"我已完成"按钮，点击后更新状态（同步至教师后台）

### （二）后台模块（教师端）

#### 1. 基础管理

*   **登录页**
    *   验证：教师账号（默认手机号）+密码（初始密码由系统生成，首次登录强制修改）
    *   安全：支持"忘记密码"（通过手机号验证码重置）

*   **仪表盘**
    *   数据概览：班级总数、学生总数、待完成作业数、今日到期作业数
    *   快捷入口：新增班级、上传材料、查看完成统计

#### 2. 班级与学生管理

*   **班级管理**
    *   功能：增删改查班级信息
    *   信息项：班级名称（如"2025秋季启蒙班"）、班级ID（系统自动生成，唯一标识）、创建时间
    *   交互：支持批量删除班级，点击班级名称可查看该班级学生列表

*   **学生管理**
    *   功能：添加学生、关联班级、删除学生
    *   信息项：学生姓名、学号（可选，教师自定义）、所属班级（支持多班级关联）
    *   交互：支持批量导入（通过Excel模板，含"姓名+学号+班级ID"字段）、单个添加

#### 3. 作业材料管理

*   **材料上传**
    *   核心功能：按"班级"或"单个学生"定向上传材料
    *   上传项：
        *   材料类型：视频（mp4格式，≤200MB）、音频（mp3格式，≤50MB）、文档（pdf/word，≤20MB）
        *   基础信息：材料标题、描述（可选，如"重点听第3分钟内容"）
        *   分发对象：选择"班级"（多选）或"学生"（多选）
        *   完成期限：通过日期时间选择器设置（精确到小时，如2025-10-30 20:00）
    *   交互：支持拖拽上传，显示实时进度条，上传失败自动重试

*   **材料管理列表**
    *   展示内容：所有已上传材料，按发布时间倒序排列
    *   信息项：材料标题、类型、分发对象（班级/学生名称）、发布时间、截止时间、已完成人数/总人数
    *   操作：支持查看详情（含学生完成状态）、编辑（仅可修改描述和截止时间）、删除

## 三、技术栈选型

### 1. 前端

*   基础框架：使用项目中的layui框架，css使用less编写
*   辅助工具：
    *   视频播放：Video.js（支持进度记忆、倍速）
    *   文档预览：pdf.js（处理pdf）、docx-preview（处理word）
    *   样式：Tailwind CSS（快速实现响应式设计）
    *   表单验证：基于layui

### 2. 后端

*   语言与框架 python + flask，基于现有程序扩展模块
*   数据库：sqlite（关系型数据库，适合存储班级/学生/材料的结构化数据）
*   存储：本机存储结合私有存储外链（存储音视频/文档，支持外链访问，降低服务器压力

### 3. 其他

本项目只借用主程序的入口，其余前后端文件全部存储在一个文件夹中，方便后期独立管理

## 四、数据模型设计

### 1. 核心表结构

#### 1.1 教师用户表（teacher_user）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 教师ID（主键） |
| phone | VARCHAR(20) | UNIQUE NOT NULL | 登录手机号（唯一） |
| password | VARCHAR(64) | NOT NULL | 加密存储的密码（MD5） |
| name | VARCHAR(50) | NOT NULL | 教师姓名 |
| avatar | VARCHAR(200) | | 头像URL |
| introduction | TEXT | | 教师简介 |
| education | TEXT | | 教育背景 |
| experience | TEXT | | 教学经验 |
| specialties | TEXT | | 擅长领域 |
| philosophy | TEXT | | 教学理念 |
| status | TINYINT | DEFAULT 1 | 状态（0禁用/1启用） |
| last_login | DATETIME | | 最后登录时间 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 1.2 班级表（teacher_class）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 班级ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| class_code | VARCHAR(20) | UNIQUE NOT NULL | 班级唯一标识（学生验证用） |
| name | VARCHAR(100) | NOT NULL | 班级名称 |
| description | TEXT | | 班级描述 |
| status | TINYINT | DEFAULT 1 | 状态（0禁用/1启用） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 1.3 学生表（teacher_student）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 学生ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| name | VARCHAR(50) | NOT NULL | 学生姓名 |
| student_no | VARCHAR(50) | | 学号（可选，教师自定义） |
| phone | VARCHAR(20) | | 联系电话 |
| parent_name | VARCHAR(50) | | 家长姓名 |
| parent_phone | VARCHAR(20) | | 家长电话 |
| notes | TEXT | | 备注信息 |
| status | TINYINT | DEFAULT 1 | 状态（0禁用/1启用） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 1.4 学生-班级关联表（teacher_student_class）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 关联ID（主键） |
| student_id | INTEGER | NOT NULL | 学生ID（外键） |
| class_id | INTEGER | NOT NULL | 班级ID（外键） |
| join_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 加入时间 |
| status | TINYINT | DEFAULT 1 | 状态（0退出/1在班） |

#### 1.5 材料表（teacher_material）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 材料ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| title | VARCHAR(200) | NOT NULL | 材料标题 |
| type | VARCHAR(10) | NOT NULL | 类型（video/audio/doc） |
| file_name | VARCHAR(200) | NOT NULL | 原始文件名 |
| file_path | VARCHAR(500) | NOT NULL | 存储路径 |
| file_url | VARCHAR(500) | | 访问URL（外链） |
| file_size | BIGINT | | 文件大小（字节） |
| file_duration | INTEGER | | 时长（秒，音视频） |
| description | TEXT | | 描述（可选） |
| deadline | DATETIME | | 完成期限 |
| is_public | TINYINT | DEFAULT 0 | 是否公开（0私有/1公开） |
| status | TINYINT | DEFAULT 1 | 状态（0删除/1正常） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 发布时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 1.6 材料-分发对象关联表（teacher_material_target）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 关联ID（主键） |
| material_id | INTEGER | NOT NULL | 材料ID（外键） |
| target_type | VARCHAR(10) | NOT NULL | 目标类型（class/student） |
| target_id | INTEGER | NOT NULL | 目标ID（班级ID/学生ID） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 分发时间 |

#### 1.7 完成状态表（teacher_completion）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 状态ID（主键） |
| material_id | INTEGER | NOT NULL | 材料ID（外键） |
| student_id | INTEGER | NOT NULL | 学生ID（外键） |
| status | TINYINT | DEFAULT 0 | 状态（0未完成/1已完成） |
| progress | INTEGER | DEFAULT 0 | 进度百分比（0-100） |
| last_position | INTEGER | DEFAULT 0 | 最后播放位置（秒） |
| complete_time | DATETIME | | 完成时间（状态为1时记录） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

### 2. 扩展表结构

#### 2.1 活动表（teacher_activity）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 活动ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| title | VARCHAR(200) | NOT NULL | 活动标题 |
| description | TEXT | | 活动描述 |
| start_time | DATETIME | NOT NULL | 开始时间 |
| end_time | DATETIME | NOT NULL | 结束时间 |
| location | VARCHAR(200) | | 活动地点 |
| location_type | VARCHAR(10) | DEFAULT 'offline' | 地点类型（online/offline） |
| max_participants | INTEGER | | 最大参与人数 |
| current_participants | INTEGER | DEFAULT 0 | 当前参与人数 |
| registration_required | TINYINT | DEFAULT 0 | 是否需要报名 |
| status | TINYINT | DEFAULT 1 | 状态（0禁用/1启用） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 2.2 课程表（teacher_course）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 课程ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| name | VARCHAR(200) | NOT NULL | 课程名称 |
| description | TEXT | | 课程描述 |
| target_age | VARCHAR(50) | | 适合年龄段 |
| difficulty | VARCHAR(20) | | 难度等级 |
| duration | INTEGER | | 课时数 |
| price | DECIMAL(10,2) | | 收费标准 |
| is_online | TINYINT | DEFAULT 0 | 是否线上课程 |
| status | TINYINT | DEFAULT 1 | 状态（0禁用/1启用） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |

#### 2.3 文件表（teacher_file）
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY AUTOINCREMENT | 文件ID（主键） |
| teacher_id | INTEGER | NOT NULL | 教师ID（外键） |
| original_name | VARCHAR(200) | NOT NULL | 原始文件名 |
| stored_name | VARCHAR(200) | NOT NULL | 存储文件名 |
| file_path | VARCHAR(500) | NOT NULL | 存储路径 |
| file_url | VARCHAR(500) | | 访问URL |
| file_size | BIGINT | NOT NULL | 文件大小（字节） |
| file_type | VARCHAR(50) | NOT NULL | 文件类型 |
| mime_type | VARCHAR(100) | NOT NULL | MIME类型 |
| hash_md5 | VARCHAR(32) | | MD5哈希值 |
| status | TINYINT | DEFAULT 1 | 状态（0删除/1正常） |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 3. 数据库索引设计

```sql
-- 教师用户表索引
CREATE INDEX idx_teacher_user_phone ON teacher_user(phone);
CREATE INDEX idx_teacher_user_status ON teacher_user(status);

-- 班级表索引
CREATE INDEX idx_teacher_class_teacher_id ON teacher_class(teacher_id);
CREATE INDEX idx_teacher_class_code ON teacher_class(class_code);
CREATE INDEX idx_teacher_class_status ON teacher_class(status);

-- 学生表索引
CREATE INDEX idx_teacher_student_teacher_id ON teacher_student(teacher_id);
CREATE INDEX idx_teacher_student_name ON teacher_student(name);
CREATE INDEX idx_teacher_student_status ON teacher_student(status);

-- 学生班级关联表索引
CREATE INDEX idx_teacher_student_class_student_id ON teacher_student_class(student_id);
CREATE INDEX idx_teacher_student_class_class_id ON teacher_student_class(class_id);
CREATE UNIQUE INDEX idx_teacher_student_class_unique ON teacher_student_class(student_id, class_id);

-- 材料表索引
CREATE INDEX idx_teacher_material_teacher_id ON teacher_material(teacher_id);
CREATE INDEX idx_teacher_material_type ON teacher_material(type);
CREATE INDEX idx_teacher_material_deadline ON teacher_material(deadline);
CREATE INDEX idx_teacher_material_status ON teacher_material(status);

-- 材料分发表索引
CREATE INDEX idx_teacher_material_target_material_id ON teacher_material_target(material_id);
CREATE INDEX idx_teacher_material_target_type_id ON teacher_material_target(target_type, target_id);

-- 完成状态表索引
CREATE INDEX idx_teacher_completion_material_id ON teacher_completion(material_id);
CREATE INDEX idx_teacher_completion_student_id ON teacher_completion(student_id);
CREATE UNIQUE INDEX idx_teacher_completion_unique ON teacher_completion(material_id, student_id);
CREATE INDEX idx_teacher_completion_status ON teacher_completion(status);
```

### 4. 数据库初始化脚本

```sql
-- 创建教师系统数据库
-- 文件路径: server/teacher/database/init_teacher_db.py

import sqlite3
import os
from datetime import datetime

def init_teacher_database():
    """初始化教师系统数据库"""
    db_path = os.path.join(os.path.dirname(__file__), 'teacher.db')
    
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    try:
        # 创建教师用户表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_user (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                phone VARCHAR(20) UNIQUE NOT NULL,
                password VARCHAR(64) NOT NULL,
                name VARCHAR(50) NOT NULL,
                avatar VARCHAR(200),
                introduction TEXT,
                education TEXT,
                experience TEXT,
                specialties TEXT,
                philosophy TEXT,
                status TINYINT DEFAULT 1,
                last_login DATETIME,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        # 创建班级表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_class (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                class_code VARCHAR(20) UNIQUE NOT NULL,
                name VARCHAR(100) NOT NULL,
                description TEXT,
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建学生表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_student (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                name VARCHAR(50) NOT NULL,
                student_no VARCHAR(50),
                phone VARCHAR(20),
                parent_name VARCHAR(50),
                parent_phone VARCHAR(20),
                notes TEXT,
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建学生班级关联表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_student_class (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                student_id INTEGER NOT NULL,
                class_id INTEGER NOT NULL,
                join_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                status TINYINT DEFAULT 1,
                FOREIGN KEY (student_id) REFERENCES teacher_student(id),
                FOREIGN KEY (class_id) REFERENCES teacher_class(id),
                UNIQUE(student_id, class_id)
            )
        ''')
        
        # 创建材料表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_material (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                title VARCHAR(200) NOT NULL,
                type VARCHAR(10) NOT NULL,
                file_name VARCHAR(200) NOT NULL,
                file_path VARCHAR(500) NOT NULL,
                file_url VARCHAR(500),
                file_size BIGINT,
                file_duration INTEGER,
                description TEXT,
                deadline DATETIME,
                is_public TINYINT DEFAULT 0,
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建材料分发表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_material_target (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                material_id INTEGER NOT NULL,
                target_type VARCHAR(10) NOT NULL,
                target_id INTEGER NOT NULL,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (material_id) REFERENCES teacher_material(id)
            )
        ''')
        
        # 创建完成状态表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_completion (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                material_id INTEGER NOT NULL,
                student_id INTEGER NOT NULL,
                status TINYINT DEFAULT 0,
                progress INTEGER DEFAULT 0,
                last_position INTEGER DEFAULT 0,
                complete_time DATETIME,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (material_id) REFERENCES teacher_material(id),
                FOREIGN KEY (student_id) REFERENCES teacher_student(id),
                UNIQUE(material_id, student_id)
            )
        ''')
        
        # 创建活动表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_activity (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                title VARCHAR(200) NOT NULL,
                description TEXT,
                start_time DATETIME NOT NULL,
                end_time DATETIME NOT NULL,
                location VARCHAR(200),
                location_type VARCHAR(10) DEFAULT 'offline',
                max_participants INTEGER,
                current_participants INTEGER DEFAULT 0,
                registration_required TINYINT DEFAULT 0,
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建课程表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_course (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                name VARCHAR(200) NOT NULL,
                description TEXT,
                target_age VARCHAR(50),
                difficulty VARCHAR(20),
                duration INTEGER,
                price DECIMAL(10,2),
                is_online TINYINT DEFAULT 0,
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                update_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建文件表
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS teacher_file (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                teacher_id INTEGER NOT NULL,
                original_name VARCHAR(200) NOT NULL,
                stored_name VARCHAR(200) NOT NULL,
                file_path VARCHAR(500) NOT NULL,
                file_url VARCHAR(500),
                file_size BIGINT NOT NULL,
                file_type VARCHAR(50) NOT NULL,
                mime_type VARCHAR(100) NOT NULL,
                hash_md5 VARCHAR(32),
                status TINYINT DEFAULT 1,
                create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (teacher_id) REFERENCES teacher_user(id)
            )
        ''')
        
        # 创建索引
        create_indexes(cursor)
        
        conn.commit()
        print("教师系统数据库初始化完成")
        
    except Exception as e:
        print(f"数据库初始化失败: {e}")
        conn.rollback()
    finally:
        conn.close()

def create_indexes(cursor):
    """创建数据库索引"""
    indexes = [
        "CREATE INDEX IF NOT EXISTS idx_teacher_user_phone ON teacher_user(phone)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_user_status ON teacher_user(status)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_class_teacher_id ON teacher_class(teacher_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_class_code ON teacher_class(class_code)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_class_status ON teacher_class(status)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_student_teacher_id ON teacher_student(teacher_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_student_name ON teacher_student(name)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_student_status ON teacher_student(status)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_student_class_student_id ON teacher_student_class(student_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_student_class_class_id ON teacher_student_class(class_id)",
        "CREATE UNIQUE INDEX IF NOT EXISTS idx_teacher_student_class_unique ON teacher_student_class(student_id, class_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_teacher_id ON teacher_material(teacher_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_type ON teacher_material(type)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_deadline ON teacher_material(deadline)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_status ON teacher_material(status)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_target_material_id ON teacher_material_target(material_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_material_target_type_id ON teacher_material_target(target_type, target_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_completion_material_id ON teacher_completion(material_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_completion_student_id ON teacher_completion(student_id)",
        "CREATE UNIQUE INDEX IF NOT EXISTS idx_teacher_completion_unique ON teacher_completion(material_id, student_id)",
        "CREATE INDEX IF NOT EXISTS idx_teacher_completion_status ON teacher_completion(status)"
    ]
    
    for index_sql in indexes:
        cursor.execute(index_sql)

if __name__ == "__main__":
    init_teacher_database()
```

## 五、技术实现方案

### 1. 项目结构设计

```
server/teacher/                    # 教师系统独立模块
├── __init__.py
├── app.py                        # 教师系统Flask应用
├── config.py                     # 配置文件
├── models/                       # 数据模型层
│   ├── __init__.py
│   ├── base.py                   # 基础模型类
│   ├── user.py                   # 教师用户模型
│   ├── class.py                  # 班级模型
│   ├── student.py                # 学生模型
│   ├── material.py               # 材料模型
│   ├── completion.py             # 完成状态模型
│   ├── activity.py              # 活动模型
│   ├── course.py                 # 课程模型
│   └── file.py                  # 文件模型
├── services/                     # 业务服务层
│   ├── __init__.py
│   ├── AuthService.py            # 认证服务
│   ├── TeacherService.py         # 教师服务
│   ├── ClassService.py           # 班级服务
│   ├── StudentService.py         # 学生服务
│   ├── MaterialService.py        # 材料服务
│   ├── FileService.py            # 文件服务
│   └── NotificationService.py    # 通知服务
├── routes/                       # 路由模块
│   ├── __init__.py
│   ├── admin.py                  # 后台管理路由
│   ├── student.py                # 学生端路由
│   ├── public.py                 # 公共展示路由
│   └── api.py                    # API接口路由
├── templates/                    # 模板文件
│   ├── admin/                    # 后台管理模板
│   │   ├── base.html
│   │   ├── login.html
│   │   ├── dashboard.html
│   │   ├── class_manage.html
│   │   ├── student_manage.html
│   │   ├── material_manage.html
│   │   └── material_upload.html
│   ├── student/                  # 学生端模板
│   │   ├── base.html
│   │   ├── login.html
│   │   ├── homework_list.html
│   │   ├── homework_detail.html
│   │   └── media_player.html
│   └── public/                   # 公共展示模板
│       ├── base.html
│       ├── index.html
│       ├── teacher_info.html
│       ├── activities.html
│       ├── courses.html
│       └── resources.html
├── static/                       # 静态资源
│   ├── css/
│   │   ├── admin.less
│   │   ├── student.less
│   │   └── public.less
│   ├── js/
│   │   ├── admin/
│   │   │   ├── dashboard.js
│   │   │   ├── class_manage.js
│   │   │   ├── student_manage.js
│   │   │   └── material_manage.js
│   │   ├── student/
│   │   │   ├── homework.js
│   │   │   └── media_player.js
│   │   └── public/
│   │       ├── teacher_info.js
│   │       └── activities.js
│   ├── uploads/                  # 文件上传目录
│   │   ├── materials/            # 材料文件
│   │   ├── avatars/              # 头像文件
│   │   └── temp/                 # 临时文件
│   └── libs/                     # 第三方库
│       ├── video.js/
│       ├── pdf.js/
│       └── docx-preview/
└── database/                     # 数据库文件
    ├── teacher.db
    └── init_teacher_db.py
```

### 2. 核心服务设计

#### 2.1 认证服务（AuthService.py）
```python
class AuthService:
    """教师系统认证服务"""
    
    def login(self, phone: str, password: str) -> dict:
        """教师登录验证"""
        pass
    
    def register(self, phone: str, password: str, name: str) -> dict:
        """教师注册"""
        pass
    
    def reset_password(self, phone: str, new_password: str) -> dict:
        """重置密码"""
        pass
    
    def student_verify(self, class_code: str, student_name: str) -> dict:
        """学生验证（班级ID+姓名）"""
        pass
```

#### 2.2 材料服务（MaterialService.py）
```python
class MaterialService:
    """材料管理服务"""
    
    def upload_material(self, teacher_id: int, file_data: dict) -> dict:
        """上传材料文件"""
        pass
    
    def distribute_material(self, material_id: int, targets: list) -> dict:
        """分发材料到班级/学生"""
        pass
    
    def get_student_materials(self, student_id: int) -> list:
        """获取学生作业材料列表"""
        pass
    
    def update_completion_status(self, material_id: int, student_id: int, status: int) -> dict:
        """更新完成状态"""
        pass
```

#### 2.3 文件服务（FileService.py）
```python
class FileService:
    """文件管理服务"""
    
    def save_file(self, file_data: dict) -> dict:
        """保存文件到本地存储"""
        pass
    
    def generate_file_url(self, file_path: str) -> str:
        """生成文件访问URL"""
        pass
    
    def validate_file_type(self, file_type: str, file_size: int) -> bool:
        """验证文件类型和大小"""
        pass
    
    def get_file_info(self, file_id: int) -> dict:
        """获取文件信息"""
        pass
```

### 3. 前端技术实现

#### 3.1 音视频播放器集成
```javascript
// 视频播放器（Video.js）
class VideoPlayer {
    constructor(container, options) {
        this.player = videojs(container, {
            controls: true,
            responsive: true,
            fluid: true,
            playbackRates: [0.5, 1, 1.25, 1.5, 2],
            ...options
        });
    }
    
    // 保存播放进度
    saveProgress(position) {
        // 调用API保存进度
    }
    
    // 恢复播放进度
    restoreProgress() {
        // 从API获取上次播放位置
    }
}

// 音频播放器
class AudioPlayer {
    constructor(container, options) {
        this.player = new Audio();
        this.setupPlayer(options);
    }
    
    setupPlayer(options) {
        // 配置音频播放器
    }
}
```

#### 3.2 文档预览组件
```javascript
// PDF预览组件
class PDFViewer {
    constructor(container, pdfUrl) {
        this.container = container;
        this.pdfUrl = pdfUrl;
        this.init();
    }
    
    async init() {
        const pdf = await pdfjsLib.getDocument(this.pdfUrl).promise;
        // 渲染PDF页面
    }
}

// Word文档预览组件
class WordViewer {
    constructor(container, docxUrl) {
        this.container = container;
        this.docxUrl = docxUrl;
        this.init();
    }
    
    async init() {
        const response = await fetch(this.docxUrl);
        const arrayBuffer = await response.arrayBuffer();
        // 使用docx-preview渲染
    }
}
```

### 4. API接口设计

#### 4.1 教师端API
```python
# 班级管理API
@teacher_bp.route('/api/classes', methods=['GET', 'POST'])
def manage_classes():
    """班级管理接口"""
    pass

@teacher_bp.route('/api/classes/<int:class_id>', methods=['PUT', 'DELETE'])
def class_detail(class_id):
    """班级详情接口"""
    pass

# 学生管理API
@teacher_bp.route('/api/students', methods=['GET', 'POST'])
def manage_students():
    """学生管理接口"""
    pass

# 材料管理API
@teacher_bp.route('/api/materials', methods=['GET', 'POST'])
def manage_materials():
    """材料管理接口"""
    pass

@teacher_bp.route('/api/materials/upload', methods=['POST'])
def upload_material():
    """材料上传接口"""
    pass
```

#### 4.2 学生端API
```python
# 学生验证API
@student_bp.route('/api/verify', methods=['POST'])
def student_verify():
    """学生验证接口"""
    pass

# 作业列表API
@student_bp.route('/api/homework', methods=['GET'])
def get_homework_list():
    """获取作业列表"""
    pass

# 完成状态API
@student_bp.route('/api/completion', methods=['POST'])
def update_completion():
    """更新完成状态"""
    pass
```

## 六、开发优先级

### 第一阶段（核心功能）
1. **数据库初始化**
   - 创建教师系统数据库
   - 实现基础表结构
   - 添加索引优化

2. **教师认证系统**
   - 教师注册/登录
   - 密码加密存储
   - Session管理

3. **班级管理**
   - 班级CRUD操作
   - 班级代码生成
   - 学生关联管理

4. **学生管理**
   - 学生信息管理
   - 班级关联
   - 学生验证

5. **基础材料上传**
   - 文件上传功能
   - 类型验证
   - 存储管理

### 第二阶段（增强功能）
1. **材料分发系统**
   - 按班级分发
   - 按学生分发
   - 分发状态管理

2. **在线播放功能**
   - 视频播放器集成
   - 音频播放器集成
   - 进度记忆功能

3. **文档预览功能**
   - PDF在线预览
   - Word文档预览
   - 页面缩放控制

4. **完成状态管理**
   - 完成状态追踪
   - 进度统计
   - 数据报表

### 第三阶段（扩展功能）
1. **公共展示功能**
   - 教师简介页
   - 活动展示页
   - 课程体系页
   - 公开资源页

2. **批量操作功能**
   - 学生批量导入
   - 材料批量分发
   - 数据导出功能

3. **移动端优化**
   - 响应式设计
   - 触摸操作优化
   - 性能优化

4. **高级功能**
   - 搜索功能
   - 筛选功能
   - 统计分析
   - 通知系统

## 七、部署和配置

### 1. 环境配置

#### 1.1 Python依赖
```bash
# 安装教师系统依赖
pip install flask sqlite3 hashlib werkzeug python-dateutil
pip install openpyxl  # Excel文件处理
pip install python-magic  # 文件类型检测
```

#### 1.2 前端依赖
```bash
# 安装前端构建工具
npm install -g less
npm install video.js pdf.js docx-preview
```

### 2. 配置文件

#### 2.1 教师系统配置（teacher/config.py）
```python
import os

class TeacherConfig:
    """教师系统配置类"""
    
    # 数据库配置
    DATABASE_PATH = os.path.join(os.path.dirname(__file__), 'database', 'teacher.db')
    
    # 文件上传配置
    UPLOAD_FOLDER = os.path.join(os.path.dirname(__file__), 'static', 'uploads')
    MAX_CONTENT_LENGTH = 200 * 1024 * 1024  # 200MB
    ALLOWED_EXTENSIONS = {
        'video': ['mp4', 'avi', 'mov'],
        'audio': ['mp3', 'wav', 'm4a'],
        'document': ['pdf', 'doc', 'docx']
    }
    
    # 文件大小限制
    MAX_FILE_SIZES = {
        'video': 200 * 1024 * 1024,  # 200MB
        'audio': 50 * 1024 * 1024,   # 50MB
        'document': 20 * 1024 * 1024  # 20MB
    }
    
    # 安全配置
    SECRET_KEY = 'your-secret-key-here'
    SESSION_COOKIE_SECURE = False
    SESSION_COOKIE_HTTPONLY = True
    SESSION_COOKIE_SAMESITE = 'Lax'
    
    # 分页配置
    DEFAULT_PAGE_SIZE = 20
    MAX_PAGE_SIZE = 100
```

#### 2.2 主应用集成配置
```python
# 在server/app.py中添加教师系统路由
from teacher.app import teacher_app

# 注册教师系统蓝图
app.register_blueprint(teacher_app, url_prefix='/teacher')

# 添加教师系统静态文件路由
@app.route('/teacher/static/<path:filename>')
def teacher_static(filename):
    return send_from_directory('teacher/static', filename)
```

### 3. 部署步骤

#### 3.1 开发环境部署
```bash
# 1. 创建教师系统目录
mkdir -p server/teacher/{models,services,routes,templates,static,database}

# 2. 初始化数据库
cd server/teacher/database
python init_teacher_db.py

# 3. 启动开发服务器
cd server
python app.py
```

#### 3.2 生产环境部署
```bash
# 1. 配置Nginx反向代理
server {
    listen 80;
    server_name your-domain.com;
    
    location /teacher/ {
        proxy_pass http://127.0.0.1:5000/teacher/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /teacher/static/ {
        alias /path/to/server/teacher/static/;
        expires 30d;
    }
}

# 2. 配置SSL证书（可选）
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # 其他配置同上
}
```

### 4. 性能优化

#### 4.1 数据库优化
```sql
-- 创建复合索引
CREATE INDEX idx_material_teacher_deadline ON teacher_material(teacher_id, deadline);
CREATE INDEX idx_completion_material_status ON teacher_completion(material_id, status);

-- 定期清理过期数据
DELETE FROM teacher_completion 
WHERE status = 1 AND complete_time < datetime('now', '-1 year');
```

#### 4.2 文件存储优化
```python
# 文件分片存储
def save_large_file(file_data, chunk_size=1024*1024):
    """大文件分片存储"""
    pass

# 文件压缩
def compress_video(input_path, output_path):
    """视频压缩"""
    pass
```

### 5. 监控和日志

#### 5.1 日志配置
```python
import logging
from logging.handlers import RotatingFileHandler

def setup_teacher_logging():
    """配置教师系统日志"""
    handler = RotatingFileHandler(
        'logs/teacher.log', 
        maxBytes=10240000, 
        backupCount=10
    )
    handler.setFormatter(logging.Formatter(
        '%(asctime)s %(levelname)s: %(message)s [in %(pathname)s:%(lineno)d]'
    ))
    handler.setLevel(logging.INFO)
    
    teacher_logger = logging.getLogger('teacher')
    teacher_logger.addHandler(handler)
    teacher_logger.setLevel(logging.INFO)
    
    return teacher_logger
```

#### 5.2 性能监控
```python
# 添加性能监控中间件
@app.before_request
def before_request():
    g.start_time = time.time()

@app.after_request
def after_request(response):
    if hasattr(g, 'start_time'):
        duration = time.time() - g.start_time
        if duration > 1.0:  # 记录超过1秒的请求
            logger.warning(f'Slow request: {request.path} took {duration:.2f}s')
    return response
```

## 八、注意事项

### 1. 安全注意事项
- **数据安全**：教师密码采用MD5加密存储，学生信息仅教师可见，材料外链设置时效（避免长期泄露）
- **文件安全**：上传文件类型严格验证，防止恶意文件上传
- **访问控制**：实现基于角色的访问控制，确保数据隔离
- **SQL注入防护**：使用参数化查询，避免SQL注入攻击

### 2. 性能注意事项
- **音视频体验**：上传前建议压缩（如视频转720p），避免加载过慢；通过CDN加速，提升不同地区访问速度
- **数据库优化**：合理使用索引，避免全表扫描
- **文件存储**：大文件分片存储，支持断点续传
- **缓存策略**：静态资源设置缓存，减少服务器压力

### 3. 用户体验注意事项
- **操作简化**：后台流程尽量精简（如上传材料时默认填充当前时间为发布时间），降低教师使用门槛
- **移动端适配**：支持主流浏览器（Chrome、Edge、微信浏览器），移动端适配优先保证作业页面可用
- **错误处理**：友好的错误提示，避免技术术语
- **加载优化**：图片懒加载，音视频预加载

### 4. 维护注意事项
- **数据备份**：定期备份数据库和上传文件
- **日志管理**：定期清理日志文件，避免磁盘空间不足
- **版本控制**：代码变更记录，便于回滚
- **测试覆盖**：关键功能单元测试，确保系统稳定性

### 5. 扩展性注意事项
- **模块化设计**：保持代码模块化，便于功能扩展
- **API设计**：RESTful API设计，便于第三方集成
- **数据库设计**：预留扩展字段，支持未来功能需求
- **配置管理**：敏感配置外部化，便于环境切换

## 九、开发时间估算

### 第一阶段（4-6周）
- 数据库设计和初始化：1周
- 教师认证系统：1周
- 班级和学生管理：1周
- 基础材料上传：1周
- 学生作业入口：1周
- 测试和调试：1周

### 第二阶段（3-4周）
- 材料分发系统：1周
- 在线播放功能：1.5周
- 文档预览功能：1周
- 完成状态管理：0.5周

### 第三阶段（2-3周）
- 公共展示功能：1周
- 批量操作功能：1周
- 移动端优化：1周

**总计：9-13周**

## 十、总结

教师系统作为独立模块集成到现有项目中，具有以下优势：

1. **技术复用**：充分利用现有技术栈和架构设计
2. **独立部署**：模块化设计便于独立维护和扩展
3. **数据隔离**：独立数据库确保数据安全
4. **功能完整**：覆盖教师教学管理的核心需求
5. **用户友好**：移动端优先，操作简单直观

通过分阶段开发，可以快速实现核心功能，逐步完善用户体验，最终形成一个功能完整、性能优良的教师课后练习管理系统。
