# 停车场管理应用（新版）

## 项目概述

这是一个基于Flask的停车场管理应用，已从主服务器根目录迁移到APP目录下，并使用新的car_park_new蓝图。应用采用Flask框架开发，使用主应用提供的layui前端框架资源。

## 功能特点

1. **月租车到期时间列表**：显示所有月租车的车牌号、车主姓名、车辆类型、到期时间等信息
2. **状态分类显示**：根据到期时间将车辆分为正常、即将到期（30天内）、已过期三种状态
3. **数据统计**：实时显示车辆总数、正常车辆数、即将到期车辆数和已过期车辆数
4. **车辆详情查看**：支持查看每辆车的详细信息，包括联系方式和备注
5. **自动刷新**：页面每10分钟自动刷新一次，确保数据最新
6. **手动刷新**：提供手动刷新按钮，可随时获取最新数据
7. **与原有car_park.py模块共享同一数据库，保持数据一致性**

## 安装与配置

### 依赖要求

- Flask
- SQLite3
- layui（使用主应用提供的资源）

### 安装步骤

1. 确保主应用已安装并配置好Flask环境
2. 将本应用放在主应用的`server/car_park`目录下
3. 确保`server/database/car_park.db`数据库存在且包含必要的表结构
4. 在主应用的`app.py`中已配置蓝图导入和注册

## 数据库结构

应用需要访问以下数据表：

### Sys_Park_Plate（车牌信息表）

主要字段：
- `id`: 主键
- `personId`: 车主ID（外键）
- `plateNumber`: 车牌号
- `plateType`: 车牌类型
- `plateStandard`: 车辆类型标准
- `beginTime`: 开始时间
- `endTime`: 结束时间
- `pRemark`: 备注信息
- `isDel`: 删除标记

### Sys_Park_Person（车主信息表）

主要字段：
- `id`: 主键
- `pName`: 车主姓名
- `pPhone`: 联系电话
- `pAddress`: 地址

## 使用方法

### 访问应用

- 新版路径：访问 `http://[服务器IP]:[端口]/car_park_new/` 查看月租车信息列表
- 旧版路径：仍然保留 `http://[服务器IP]:[端口]/car_park/`（基于car_park.py）

### API接口

#### 获取所有车辆信息

```
GET /car_park/api/cars
```

返回数据格式：
```json
{
  "status": "success",
  "data": [
    {
      "car_number": "川A12345",
      "owner": "张三",
      "expire_time": "2025-12-31 23:59:59",
      "expire_time_display": "2025-12-31",
      "remaining_days": 60,
      "status": "normal",
      "car_type": 1,
      "car_type_name": "业主首车",
      "phone": "13800138000",
      "address": "1栋1单元101",
      "remark": "备注信息"
    }
  ],
  "count": 1
}
```

## 页面说明

### 首页

首页显示所有月租车的列表，包含以下信息：
- 车牌号
- 车主姓名
- 车辆类型
- 到期时间
- 剩余天数（带颜色标识）
- 状态（正常/即将到期/已过期）
- 联系电话
- 住址
- 备注

### 车辆状态颜色说明

- **绿色**：正常状态（距离到期超过30天）
- **橙色**：即将到期（距离到期30天内）
- **红色**：已过期

## 注意事项

1. 应用依赖于主应用的数据库连接配置
2. 请确保数据库表结构正确，否则可能导致数据查询失败
3. 页面自动刷新时间为10分钟，可根据需要调整
4. 如果数据库连接失败，请检查数据库文件路径和权限

## 错误处理

如果页面加载失败，将显示错误页面，显示具体的错误信息。常见错误原因：

1. 数据库连接失败
2. 数据库表结构不正确
3. 权限问题

## 版本信息

- **版本**：1.0.0
- **作者**：一根鱼骨棒
- **邮箱**：775639471@qq.com
- **创建日期**：2025-11-01
- **许可证**：GPL 3.0