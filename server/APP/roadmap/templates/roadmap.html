<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>计划管理</title>
    <!-- 引入 Layui CSS -->
    <link rel="stylesheet" href="/static/layui/css/layui.css" />
    <link rel="icon" type="image/svg+xml" href="/static/img/favicon_roadmap.svg">
    <link rel="stylesheet" href="{{ url_for('roadmap.static', filename='css/index.min.css') }}" />
  </head>

  <body>
    <!-- 新增header -->
    <div class="header">
        <div class="header-title">
            <!-- <i class="layui-icon layui-icon-list"></i> -->
            <i>
                <img src="/static/img/logo_roadmap.svg" alt="logo" style=" height:100%;">
            </i>
            <!-- <span>计划管理</span> -->
        </div>
        <div class="user-info">
            <div class="theme-switch" id="themeSwitch">
                <i class="layui-icon layui-icon-light"></i>
            </div>
            <span>当前用户：</span>
            <span class="username" id="currentUser"></span>
            <!-- SSE连接状态指示灯 -->
            <div class="sse-status" id="sseStatus" title="SSE连接状态">
                <span class="status-dot"></span>
                <span class="status-text">SSE连接：</span>
                <span class="status-value">未连接</span>
            </div>
            <span class="logout-btn" title="退出登录">
                <i class="layui-icon layui-icon-logout"></i>
            </span>
        </div>
    </div>

    <div class="layui-container">
      <!-- 新增颜色图例说明 -->
      <div class="color-legend">
        <div class="legend-title">任务类别说明：</div>
        <div class="legend-items">
          <div class="legend-item">
            <span class="color-dot" style="background-color: #1e9fff;"></span>
            <span class="legend-text">任务开发</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #16b777;"></span>
            <span class="legend-text">样式开发</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #3f51b5;"></span>
            <span class="legend-text">学习任务</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #ffb800;"></span>
            <span class="legend-text">内容开发</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #ff5722;"></span>
            <span class="legend-text">BUG处理计划</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #a233c6;"></span>
            <span class="legend-text">新功能开发</span>
          </div>
          <div class="legend-item">
            <span class="color-dot" style="background-color: #fafafa;"></span>
            <span class="legend-text">默认计划</span>
          </div>
        </div>
      </div>
      <div class="task-board">
        <div class="task-column" data-status="PLANNED">
          <div class="column-title">
            <span class="title-text">计划中 <span class="task-count">(0)</span></span>
            <button class="layui-btn layui-btn-primary add-task-btn" data-status="PLANNED">
              <i class="layui-icon">&#xe654;</i>
            </button>
          </div>
          <div class="task-list" id="planned-list"></div>
        </div>
        <div class="task-column" data-status="WORKING">
          <div class="column-title">
            <span class="title-text">工作中 <span class="task-count">(0)</span></span>
            <button class="layui-btn layui-btn-primary add-task-btn" data-status="WORKING">
              <i class="layui-icon">&#xe654;</i>
            </button>
          </div>
          <div class="task-list" id="working-list"></div>
        </div>
        <div class="task-column" data-status="COMPLETED">
          <div class="column-title">
            <span class="title-text">已完成 <span class="task-count">(0)</span></span>
            <button class="layui-btn layui-btn-primary add-task-btn" data-status="COMPLETED">
              <i class="layui-icon">&#xe654;</i>
            </button>
          </div>
          <div class="task-list" id="completed-list"></div>
        </div>
      </div>
    </div>

    <!-- 引入 Layui JavaScript -->
    <script src="/static/layui/layui.js"></script>
    
    <!-- 唯一的应用入口 -->
    <script src="{{ url_for('roadmap.static', filename='js/client/app.js') }}"></script>
    <!-- 保留原有roadmap.js，用于兼容旧代码 -->
    <!-- <script src="{{ url_for('roadmap.static', filename='js/client/roadmap.js') }}"></script> -->

    <!-- 添加任务表单模板 -->
    <script type="text/html" id="taskFormTpl">
      <div class="layui-form" style="padding: 20px;">
        <div class="layui-form-item">
          <label class="layui-form-label">任务名称</label>
          <div class="layui-input-block">
            <input type="text" name="name" required lay-verify="required" class="layui-input" />
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">描述</label>
          <div class="layui-input-block">
            <textarea name="description" class="layui-textarea"></textarea>
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">颜色</label>
          <div class="layui-input-block" id="colorOptions"></div>
        </div>
        <!-- 周期任务配置 -->
        <div class="layui-form-item">
          <label class="layui-form-label">周期任务</label>
          <div class="layui-input-block">
            <input type="checkbox" name="is_cycle_task" lay-skin="switch" lay-text="是|否" lay-filter="is_cycle_task" />
          </div>
        </div>
        <div class="layui-form-item cycle-duration-row" style="display: none;">
          <label class="layui-form-label">周期时长（天）</label>
          <div class="layui-input-block">
            <input type="number" name="cycle_duration" min="1" class="layui-input" placeholder="输入周期时长，如90表示每3个月" />
          </div>
        </div>
        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="submitTask" id="submitTaskBtn">
              <span>提交</span>
              <i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="display:none"></i>
            </button>
          </div>
        </div>
      </div>
    </script>

    <!-- 登录表单模板 -->
    <script type="text/html" id="loginFormTpl">
      <div class="layui-form login-form">
        <div class="layui-form-item">
          <label class="layui-form-label">用户名</label>
          <div class="layui-input-block">
            <input type="text" name="username" required lay-verify="required" class="layui-input" />
          </div>
        </div>
        <div class="layui-form-item">
          <label class="layui-form-label">密码</label>
          <div class="layui-input-block">
            <input type="password" name="password" required lay-verify="required" class="layui-input" />
          </div>
        </div>
        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="loginSubmit">登录</button>
          </div>
        </div>
      </div>
    </script>
  </body>
</html>