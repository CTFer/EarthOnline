{% extends "admin/base.html" %}

{% block title %}学生管理 - 教师管理系统{% endblock %}

{% block content %}
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0;">学生管理</h2>
                    <div class="layui-btn-group">
                        <button class="layui-btn layui-btn-normal" onclick="addStudent()">
                            <i class="layui-icon layui-icon-add-1"></i> 新增学生
                        </button>
                        <button class="layui-btn layui-btn-warm" onclick="importStudents()">
                            <i class="layui-icon layui-icon-upload"></i> 批量导入
                        </button>
                    </div>
                </div>
                <div class="layui-card-body">
                    <!-- 筛选条件 -->
                    <div class="layui-form layui-row layui-col-space10">
                        <div class="layui-col-md3">
                            <select name="class_id" lay-filter="classFilter">
                                <option value="">选择班级</option>
                            </select>
                        </div>
                        <div class="layui-col-md3">
                            <input type="text" name="keyword" placeholder="搜索学生姓名" class="layui-input">
                        </div>
                        <div class="layui-col-md2">
                            <button class="layui-btn" onclick="searchStudents()">搜索</button>
                        </div>
                    </div>
                    
                    <table class="layui-table" lay-data="{url:'/teacher/api/students', page:true, id:'studentTable'}" lay-filter="studentTable">
                        <thead>
                            <tr>
                                <th lay-data="{field:'id', width:80}">ID</th>
                                <th lay-data="{field:'name', width:120}">学生姓名</th>
                                <th lay-data="{field:'student_no', width:120}">学号</th>
                                <th lay-data="{field:'phone', width:120}">联系电话</th>
                                <th lay-data="{field:'parent_name', width:120}">家长姓名</th>
                                <th lay-data="{field:'parent_phone', width:120}">家长电话</th>
                                <th lay-data="{field:'classes', width:200, templet:'#classTpl'}">所属班级</th>
                                <th lay-data="{field:'create_time', width:150}">创建时间</th>
                                <th lay-data="{field:'status', width:80, templet:'#statusTpl'}">状态</th>
                                <th lay-data="{fixed: 'right', width:200, align:'center', toolbar: '#barDemo'}">操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 班级模板 -->
<script type="text/html" id="classTpl">
    <div class="class-badges">
        <!-- 班级标签将通过JavaScript动态生成 -->
    </div>
</script>

<!-- 状态模板 -->
<script type="text/html" id="statusTpl">
    <div class="status-badge">
        <!-- 状态标签将通过JavaScript动态生成 -->
    </div>
</script>

<!-- 操作按钮模板 -->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="classes">班级</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
</script>

<!-- 新增/编辑学生表单 -->
<div id="studentForm" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="studentForm">
        <input type="hidden" name="id" value="">
        <div class="layui-form-item">
            <label class="layui-form-label">学生姓名</label>
            <div class="layui-input-block">
                <input type="text" name="name" required lay-verify="required" placeholder="请输入学生姓名" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学号</label>
            <div class="layui-input-block">
                <input type="text" name="student_no" placeholder="请输入学号" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">联系电话</label>
            <div class="layui-input-block">
                <input type="text" name="phone" placeholder="请输入联系电话" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">家长姓名</label>
            <div class="layui-input-block">
                <input type="text" name="parent_name" placeholder="请输入家长姓名" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">家长电话</label>
            <div class="layui-input-block">
                <input type="text" name="parent_phone" placeholder="请输入家长电话" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea name="notes" placeholder="请输入备注信息" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="submitStudent">确定</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>

<!-- 学生班级关联表单 -->
<div id="studentClassForm" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="studentClassForm">
        <input type="hidden" name="student_id" value="">
        <div class="layui-form-item">
            <label class="layui-form-label">选择班级</label>
            <div class="layui-input-block">
                <div id="classCheckboxes"></div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="submitStudentClass">确定</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>

<!-- 批量导入学生表单 -->
<div id="studentImportForm" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="studentImportForm">
        <div class="layui-form-item">
            <label class="layui-form-label">模板下载</label>
            <div class="layui-input-block">
                <button type="button" class="layui-btn layui-btn-normal" onclick="downloadTemplate()">
                    <i class="layui-icon layui-icon-download-circle"></i> 下载Excel模板
                </button>
                <div class="layui-form-mid layui-word-aux">请先下载模板，填写学生信息后上传</div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">选择文件</label>
            <div class="layui-input-block">
                <div id="uploadArea">
                    <button type="button" class="layui-btn" id="uploadBtn">
                        <i class="layui-icon layui-icon-upload"></i> 选择文件
                    </button>
                </div>
                <div id="fileInfo" style="margin-top: 10px;"></div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="submitImport">确定导入</button>
                <button type="reset" class="layui-btn layui-btn-primary">取消</button>
            </div>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script src="/teacher/static/js/admin/student_manage.js"></script>
{% endblock %}
