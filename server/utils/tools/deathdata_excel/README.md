# 人员Excel表匹配与拆分工具

## 功能介绍

本工具用于处理两份包含人员信息的Excel文件（主表、附表），实现以下功能：

1. **人员信息匹配**：以身份证号为唯一标识，从主表中筛选出与附表中身份证号重合的人员数据，生成表C
2. **人员对比**：生成对比表，展示附表中人员在主表中的存在状态
3. **按户籍拆分**：将表C按"户籍所在乡镇（街道）"字段拆分，为每个乡镇/街道生成单独的Excel文件

## 技术实现

- 开发语言：Python
- 核心依赖库：pandas、openpyxl、re

## 使用方法

### 1. 安装依赖

```bash
pip install pandas openpyxl
```

### 2. 准备数据

- **主表**：包含列名：人名、身份证号、户籍所在乡镇（街道）
- **附表**：包含列名：人名、身份证号
- 将主表和附表文件放置在脚本同一目录下

### 3. 配置参数

编辑`deathdata_excel.py`文件，修改以下参数：

```python
MAIN_EXCEL_PATH = "主表.xlsx"  # 主表文件路径
SUB_EXCEL_PATH = "附表.xlsx"   # 附表文件路径
OUTPUT_DIR = "./人员数据处理结果"  # 结果输出根目录
```

### 4. 运行脚本

```bash
python deathdata_excel.py
```

## 输出结果

运行成功后，结果将生成在`人员数据处理结果`文件夹下：

- `匹配人员表C.xlsx`：主表与附表匹配成功的人员数据
- `主表-附表人员对比表.xlsx`：附表人员在主表中的存在状态
- `按户籍拆分/`：按乡镇/街道拆分的Excel文件，文件名格式为`[户籍所在乡镇（街道）].xlsx`

## 代码增强功能

1. **身份证号合法性校验**：验证18位身份证号的格式是否合规
2. **数据清理**：
   - 移除全部为空的行
   - 移除必需列包含空值的行
   - 移除身份证号无效的数据
3. **文件名安全处理**：自动替换户籍名称中的特殊字符（如/、\、:、*、?、"、<、>、|）为下划线，避免文件名非法
4. **完善的错误处理**：捕获并提示文件不存在、数据校验失败等异常

## 示例运行日志

```
读取主表和附表数据...
主表中移除了2行必需列有空值的数据
主表中移除了1行身份证号无效的数据
附表中移除了1行必需列有空值的数据
匹配主表与附表人员...
表C已生成：./人员数据处理结果/匹配人员表C.xlsx
生成人员对比表...
对比表已生成：./人员数据处理结果/主表-附表人员对比表.xlsx
按户籍拆分表C...
户籍[街道1]的文件已生成：./人员数据处理结果/按户籍拆分/街道1.xlsx
户籍[街道2]的文件已生成：./人员数据处理结果/按户籍拆分/街道2.xlsx
所有操作执行完成！
```

## 注意事项

1. 确保主表和附表的列名与要求一致，否则会报错
2. 身份证号必须为18位有效格式，否则会被过滤
3. 必需列（人名、身份证号、户籍所在乡镇（街道））不能为空，否则会被过滤
4. 脚本会自动创建输出目录，无需手动创建
